# IPNS RV
InterPlanetary Name System Rolling Versioning (IPNS RV) — это система автоматического обновления программ и набор спецификаций, основанный на IPNS. В данном случае речь идёт об общих принципах системы. Известным проектом, придерживающимся IPNS RV, является [Tor Portable](https://github.com/Verity-Freedom/Tor-Portable).

1. IPNS RV допускает распространение как копилефт софта, так и коммерческую реализацию в бинарном коде.
2. Программа, придерживающаяся IPNS RV, хранит себя через архив по постоянной IPNS ссылке. Не допускается смена номера версии через название архива. Название архива также должно оставаться идентичным, за исключением крайних случаев, так как его смена уничтожит обратную совместимость, ломая автоматические обновления.
3. При необходимости всё же менять названия архивов, IPNS RV может быть завёрнут сам в себя, загружая не программу, а файл обновления, указывающий на программу. Однако подобное, хотя и допустимо, сильно противоречит [KISS](https://en.wikipedia.org/wiki/KISS_principle) и не рекомендуется.
4. Форматы архивов для IPNS RV должны быть широкоизвестными и кроссплатформенными, вроде .zip.
5. Текущая версия программы может быть указана через специальный файл (для примера назовём его VERSION 1.0) внутри самого архива, в её интерфейсе и в свойствах бинарных файлов. Внутрь файла VERSION 1.0 можно поместить историю версий в любом удобном формате.
6. Программа, размещённая по системе IPNS RV, не хранит историю версий по актуальной ссылке, вместо этого всегда указывая на последнюю версию. Это делает удобным сокрытие предыдущих версий и невозможным их случайное скачивание. Однако в файловой системе IPFS предыдущие версии всегда остаются и могут быть использованы внутри команды разработки как бэкапы.
7. Само автоматическое обновление происходит по схеме: 1) перевод директории на текущую; 2) удаление всех файлов и директорий в папке (за исключением пользовательских при наличии); 3) скачивание архива; 4) распаковка архива; 5) удаление архива. Реализации на Windows и Linux отличаются: Linux хранит исполняемый скрипт в оперативной памяти и делает возможным его горячее удаление, в отличие от Windows. Поэтому в реализации на Windows необходимо создание второго скрипта, который возьмёт на себя работу после удаления первого. На языке batch поддержка начиная с Windows 10.
8. На Linux эталонным детерменированным развёртыванием является использование портативных библиотек через `./ld-linux-x86-64.so.2 --library-path .`, что позволяет запускаться любым программам в идентичной среде, независимо от дистрибутива. IPNS RV допускает молниеносные обновления как самой программы, так и портативных библиотек.
9. В зависимости от того, предпочитаете ли вы графическую настройку или работу с терминалом, вам так или иначе необходимо сделать две вещи: 1) загрузите программу в IPFS; 2) создайте обновляемый IPNS указатель на неизменную IPFS ссылку. Я предпочитаю делать первое через графический интерфейс app.pinata.cloud, а второе через ipns.ipfs.network. Однако вы можете освоить более сложную работу с десктопными приложениями [kubo](https://github.com/ipfs/kubo) и [helia](https://github.com/ipfs/helia).

На этом описание спецификаций IPNS RV закончено.

## Почему именно IPNS RV?
1. Простота. Не требуется установки никаких отдельных пакетов для соблюдения всех спецификаций.
2. Заложенный в архитектуру rolling-release гарантирует, что пользователь получит только последнюю версию приложения, избегая несовместимостей и устаревающих ссылок. Действительность ссылки может быть прекращена в любой момент или использоваться неограниченно долго.
3. Вечное, бесплатное, открытое файловое пространство без ограничений к доступу, кроме искусственно налагаемых провайдерами. Независимое файловое пространство обеспечивает мощную защиту от сторонней модерации, не требует покупки данных.
4. Нативная поддержка автообновлений.
5. Совместимость как со свободным, так и с проприетарным софтом.
6. Любой файл автообновления имеет крайне небольшой размер и при этом генерирует уже распакованную программу по щелчку, что позволяет избегать ограничений на передачу файлов большого размера.
7. Сохранение битов исполнения и любых метаданных в распакованных файлах, в отличие от, например, git-clone.
8. Возможность передачи любых видов информации, включая постоянно пополняемых коллекций изображений и музыки.
